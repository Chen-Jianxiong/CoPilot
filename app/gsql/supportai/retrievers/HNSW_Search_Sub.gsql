CREATE QUERY HNSW_Search_Sub(
  STRING milvus_host,
  UINT milvus_port,
  STRING vertex_type,
  STRING input,
  STRING index_name,
  UINT k=10
) RETURNS(SET<VERTEX>) {
  ListAccum<STRING> @@vertexIds = searchInMilvus(milvus_host,
                                                 milvus_port,
                                                 index_name,
                                                 "embedding",
                                                 "vertex_id",
                                                 input,
                                                 "L2",
                                                 k);

  SetAccum<VERTEX> @@vertices;

  start = {vertex_type};

  res = SELECT s FROM start:s WHERE s.vertex_id IN @@vertexIds 
        POST-ACCUM @@vertices += s;

  IF @@vertices.size() < k THEN
    RETURN HNSW_Search_Sub(milvus_host, milvus_port, vertex_type, input, index_name, k*2);
  END;

  RETURN @@vertices;
}